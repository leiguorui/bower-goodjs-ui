angular.module("goodow.ui",["goodow.ui.services","goodow.ui.svg"]);
var serviceModule;!function(t,r){serviceModule=r.module("goodow.ui.services",[]).factory("goodowConstant",function(){return{SVG_SID:"someaddress.s",SERVER:"http://test.goodow.com:8080/eventbus"}}).factory("realtimeService",["goodowConstant",function(r){var o={debug:!0,forkLocal:!0};return function(){var e=new t.good.channel.WebSocketBus(r.SERVER,o);return e}}]).factory("goodowUtil",function(){function t(t,r){t.style("-webkit-transform",r).style("-moz-transform",r).style("-o-transform",r).style("transform",r)}return{transform:t}}).factory("graphService",["goodowUtil",function(t){var o=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("linear"),e=null,n=null,a=function(r,o){if("rect"===r.type){var e=o.append("g").append("rect");e.attr("fill",r.fill).attr("stroke",r.stroke).attr("stroke-width",r["stroke-width"]).attr("stroke-linecap","round"),e.attr("x",r.x).attr("y",r.y).attr("width",r.width).attr("height",r.height),r.transform&&t.transform(e,"rotate("+r.transform.rotate+"deg)")}},i=function(r,o){var e=o.append("g").append("ellipse");e.attr("fill",r.fill).attr("stroke",r.stroke).attr("stroke-width",r["stroke-width"]).attr("stroke-linecap","round"),e.attr("cx",r.cx).attr("cy",r.cy).attr("rx",r.rx).attr("ry",r.ry),r.transform&&t.transform(e,"rotate("+r.transform.rotate+"deg)")},s=function(e,n){var a=n.append("g").append("path");a.attr("stroke",e.stroke).attr("stroke-width",e["stroke-width"]).attr("fill","none").attr("stroke-linecap","round"),r.isArray(e.d)&&e.d.length>=2&&a.attr("d",o(e.d)),e.transform&&t.transform(a,"rotate("+e.transform.rotate+"deg)")},l={ellipse:i,path:s,rect:a};return{drawGraph:function(t){var o=l[t.type],a=d3.select("#mysvg");if(e=a.property("height").animVal.value,n=a.property("width").animVal.value,!r.isFunction(o))throw new Error(o+" is not a function");o.call(null,t,a)},lineFunction:function(){return o}}}])}(window,angular);
"use strict";angular.module("goodow.ui.svg",["goodow.ui.services"]).controller("SVGController",["$scope","realtimeService","goodowConstant","$log",function(t,e,a){var r=e();r.registerHandler("@goodow.bus.onOpen",function(){console.log("Opened at: "+(new Date).toString())}),r.registerHandler("@goodow.bus.onClose",function(){console.log("Closed at: "+(new Date).toString())}),r.registerHandler("@goodow.bus.onError",function(){});r.registerHandler(a.SVG_SID,function(e){t.$apply(function(t){t.data=e.body()})});t.$watch("sendData",function(){t.sendData&&r.publish(a.SVG_SID,t.sendData)})}]).directive("goodowcanvas",["realtimeService","goodowConstant","graphService",function(t,e,a){function r(t,e){"rect"==e.type?t.attr("width",e.width).attr("height",e.height).attr("x",e.startX).attr("y",e.startY):"ellipse"==e.type?t.attr("rx",e.rx).attr("ry",e.ry).attr("cx",e.startX).attr("cy",e.startY):"path"==e.type&&t.attr("d",s(e.d))}var s=a.lineFunction(),o=function(t){var e=d3.select("#mysvg").append("g"),a=e.append(t.type).attr("fill",t.fill).attr("stroke",t.stroke).attr("stroke-width",t.stroke_width).attr("stroke-dasharray",t.stroke_dasharray).attr("stroke-linecap","round");return a},i=function(e,i){var n,l={fill:"none",stroke:"blue",stroke_width:1,stroke_dasharray:"1,2",canDraw:!1,hasDrawFinish:!0};n=angular.extend({},l),e.$watch("data",function(){var t,r=e.data;for(var s in r)t=angular.extend({},r[s]),t.type=s,a.drawGraph(t)});var d,h,p,c=i.find("svg")[0];d3.select(c).on("mousedown",function(){var t=this;if(1==d3.event.which)switch(e.shape){case"ellipse":n.type="ellipse",n.rx=0,n.ry=0,n.tempX=d3.event.offsetX,n.tempY=d3.event.offsetY,n.canDraw=!0,n.hasDrawFinish=!1,d=o(n);break;case"rect":n.type="rect",n.width=0,n.height=0,n.startX=n.tempX=d3.event.offsetX,n.startY=n.tempY=d3.event.offsetY,n.canDraw=!0,n.hasDrawFinish=!1,h=o(n);break;case"path":n.type="path",n.d=[],n.d.push([d3.event.offsetX,d3.event.offsetY]),n.canDraw=!0,n.hasDrawFinish=!1,p=o(n)}d3.select(t).on("mouseup",function(){var t=this;if(1==d3.event.which){d3.select(t).attr("style","cursor:default"),n.canDraw=!1,n.hasDrawFinish=!0;var a={};if("rect"==n.type)h.attr("fill",e.fill).attr("stroke-width",e.stroke_width).attr("stroke",e.stroke).attr("stroke-dasharray",""),a.rect={},a.rect.x=n.startX,a.rect.y=n.startY,a.rect.width=n.width,a.rect.height=n.height,a.rect.fill=e.fill,a.rect.stroke=e.stroke,a.rect["stroke-width"]=e.stroke_width;else if("ellipse"==n.type)d.attr("fill",e.fill).attr("stroke-width",e.stroke_width).attr("stroke",e.stroke).attr("stroke-dasharray",""),a.ellipse={},a.ellipse.cx=n.startX,a.ellipse.cy=n.startY,a.ellipse.rx=n.rx,a.ellipse.ry=n.ry,a.ellipse.fill=e.fill,a.ellipse.stroke=e.stroke,a.ellipse["stroke-width"]=e.stroke_width;else if("path"==n.type){console.log(JSON.stringify(n.d));var r=void 0==e.stroke_width||0==e.stroke_width?1:e.stroke_width,o=void 0==e.stroke?"black":e.stroke;p.attr("d",s(n.d)).attr("stroke-width",r).attr("stroke",o).attr("fill","none").attr("stroke-dasharray",""),a.path={},a.path.d=n.d,a.path.fill=e.fill,a.path.stroke=o,a.path["stroke-width"]=r}}e.$apply(function(t){t.sendData=a}),d3.select(t).on("mousemove",null).on("mouseup",null)}).on("mousemove",function(){if(n.canDraw){var t=this;d3.select(t).attr("style","cursor:crosshair");var e=d3.event.offsetX,a=d3.event.offsetY;"rect"==n.type?(n.width=e-n.tempX,n.height=a-n.tempY,n.width<0&&(n.startX=e,n.width=Math.abs(n.width)),n.height<0&&(n.startY=a,n.height=Math.abs(n.height)),r(h,n)):"ellipse"==n.type?(n.rx=Math.abs(e-n.tempX)/2,n.ry=Math.abs(a-n.tempY)/2,n.startX=n.tempX+(e-n.tempX)/2,n.startY=n.tempY+(a-n.tempY)/2,r(d,n)):"path"==n.type&&(n.d.push([d3.event.offsetX,d3.event.offsetY]),p.attr("d",s(n.d)))}})}),i.on("$destroy",function(){t.close()})};return{restrict:"E",controller:"SVGController",link:i,templateUrl:"partials/canvasDirective.html"}}]).run(["$templateCache",function(t){t.put("partials/canvasDirective.html",'<div class="nav" id="draw_menu" ><input type="radio" name="path" ng-model="shape" value="line"/>  zhi<input type="radio" name="path" ng-model="shape" value="path2"/> jian<input type="radio" name="path" ng-model="shape" value="path3"/> qu<input type="radio" name="path" ng-model="shape" value="path4"/>  zhe<input type="radio" name="path" ng-model="shape" value="path5"/> hu<input type="radio" name="path" ng-model="shape" value="path"/> ziyou<input type="radio"  ng-model="shape" value="rect"/>  juxing<input type="radio"  ng-model="shape" value="ellipse"/> tuoyuan<input type="text" name="basic" ng-model="stroke" id="border_color"/>RGB or name ：边框颜色<input type="text" name="basic" ng-model="fill" id="fill_color"/>RGB or name :填充颜色<input type="text" name="basic" ng-model="stroke_width" id="border_width"/>Number</div><svg id="mysvg"></svg>')}]);